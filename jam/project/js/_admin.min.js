(function(a,b){"use strict";var c=a.$;function d(){}a.task_events=new d();function e(){var d={"ROOT_TYPE":1,"USERS_TYPE":2,"ROLES_TYPE":3,"TASKS_TYPE":4,"TASK_TYPE":5,"CATALOGS_TYPE":6,"JOURNALS_TYPE":7,"TABLES_TYPE":8,"REPORTS_TYPE":9,"CATALOG_TYPE":10,"JOURNAL_TYPE":11,"TABLE_TYPE":12,"REPORT_TYPE":13,"DETAIL_TYPE":14},e={"SQLITE":1,"FIREBIRD":2,"POSTGRESQL":3,"MYSQL":4};function f(a){task.btns_panel.hide();task.btns_panel.empty();task.view_panel.empty();a.task.cur_item_title=a.f_name.value;if(a.type_id.value===d.ROOT_TYPE){task.view_panel.append(c('<h4>'+task.language.admin+' - '+task.task_caption+'</h4>'));task.right_panel.show();m(a.task);}else if(a.type_id.value===d.USERS_TYPE){task.right_panel.hide();a.task.sys_users.view(task.view_panel);}else if(a.type_id.value===d.ROLES_TYPE){task.right_panel.hide();a.task.sys_roles.view(task.view_panel);}else{task.right_panel.show();a.task.sys_items.tree_changed(a.task.sys_items);}task.btns_panel.show();}function g(a,b){a.server_function('server_update_has_children',[]);a.item_tree.set_where({has_children:true});a.item_tree.open();a.item_tree.locate('type_id',d.TASK_TYPE);a.tree.expand(a.tree.selected_node);a.item_tree.on_after_scroll=f;if(b)a.item_tree.locate('id',b);else a.item_tree.locate('type_id',d.ROOT_TYPE);a.tree_panel.show();f(a.item_tree);}function h(b){var f,h;b.init_project=true;b.item_types=d;b.db_types=e;b.sys_params.open();if(!b.sys_params.f_language.value){b.sys_params.set_edit_fields(['f_language']);b.sys_params.item_caption='Project language';b.sys_params.edit_record();return;}b.sys_tasks.open();if(!b.sys_tasks.f_db_type.value){h=['f_name','f_item_name','f_db_type','f_alias','f_login','f_password','f_host','f_port','f_encoding'];b.sys_tasks.set_edit_fields(h);b.sys_tasks.item_caption=b.language.project_params;b.sys_tasks.edit_record();return;}if(b.sys_params.f_language.value&&b.sys_tasks.f_db_type.value){b.init_project=false;b.buttons_info={divider:{},project_params:{handler:w,short_cut:'F2',key_code:113},project_locale:{handler:x,short_cut:'F3',key_code:114},db:{handler:y,short_cut:'F4',key_code:115},'export':{handler:E,short_cut:'Ctrl-E',key_code:69,key_ctrl:true},'import':{handler:D,short_cut:'Ctrl-I',key_code:73,key_ctrl:true},find:{handler:z,short_cut:'Alt-F',key_code:70,key_alt:true},print:{handler:B,short_cut:'Shift-P',key_code:80,key_shift:true},client_module:{handler:b.sys_items.edit_client,item:b.sys_items,short_cut:'F8',key_code:119},server_module:{handler:b.sys_items.edit_server,item:b.sys_items,short_cut:'F9',key_code:120},'index.html':{handler:b.sys_items.edit_index_html,item:b.sys_items,short_cut:'F10',key_code:121},'project.css':{handler:b.sys_items.edit_project_css,item:b.sys_items,short_cut:'F11',key_code:122},viewing:{handler:b.sys_items.view_setup,item:b.sys_items},editing:{handler:b.sys_items.edit_setup,item:b.sys_items},filters:{handler:b.sys_items.filters_setup,item:b.sys_items},details:{handler:b.sys_items.details_setup,item:b.sys_items},order:{handler:b.sys_items.order_setup,item:b.sys_items},indices:{handler:b.sys_items.indices_setup,item:b.sys_items},foreign_keys:{handler:b.sys_items.foreign_keys_setup,item:b.sys_items},reports:{handler:b.sys_items.reports_setup,item:b.sys_items},report_params:{handler:b.sys_items.report_params_setup,item:b.sys_items}};c("#title").html(b.item_caption);if(b.safe_mode){c("#user-info").text(b.user_info.role_name+' '+b.user_info.user_name);c('#log-out').show().click(function(a){a.preventDefault();b.logout();});}b.left_panel=c("#left-panel");b.center_panel=c("#center-panel");b.right_panel=c("#right-panel");b.btns_panel=c("#btns-panel");b.view_panel=c("#view-panel");b.tree_panel=c("#tree-panel");i(b);b.item_tree=b.sys_items.copy({handlers:false,details:false});b.tree=b.item_tree.create_tree(b.tree_panel,{id_field:'id',parent_field:'parent',text_field:'f_name',parent_of_root_value:0});b.tree.$element.height(c("#left-panel").height());g(b);c(a).on('resize',function(){K(b);});K(b);}}function i(a){var b=a.sys_items.copy();b.set_where({type_id:d.TASK_TYPE});b.open();a.task_name=b.f_item_name.value;a.task_caption=b.f_name.value;}function j(b,d,e,f,g,h,i,j,k,l){function m(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation();if(f)e.call(f,f,b.language[d]);else e.call(b,b,b.language[d]);}var n='',o='',p='',q;if(d){n=b.language[d];if(!n)n=d;}if(g)o='<i class="'+g+'"></i>';if(h)p='<small class="muted">&nbsp;['+h+']</small>';q=c('<button class="btn vert-btn text-center" type="button">'+o+' '+n+p+'</button>');b.btns_panel.append(q);if(e)q.click(function(a){m(a);});if(i){c(a).off('keydown.'+d);c(a).on('keydown.'+d,(function(a){var b=(a.keyCode?a.keyCode:a.which);if(j&&a.ctrlKey&&i===a.keyCode||k&&a.shiftKey&&i===a.keyCode||l&&a.altKey&&i===a.keyCode||!j&&!k&&!l&&i===a.keyCode)m(a);}));}}function k(){task.btns_panel.append('<div class="btns-divider">');}function l(a,b){var c=0,d=b.length,e,f;for(;c<d;c++){e=b[c];if(e==='divider')k();else{f=a.buttons_info[e];j(a,e,f.handler,f.item,f.icon,f.short_cut,f.key_code,f.key_ctrl,f.key_shift,f.key_alt);}}}function m(a){l(a,['project_params','project_locale','divider','db','divider','export','import','divider','find','print']);}function n(a){var b,d,e=[];if(a.reports){for(var f=0;f<a.reports.length;f++)if(a.reports[f].can_view())e.push(a.reports[f]);if(e.length){b=a.view_form.find("#report-btn ul");for(var f=0;f<e.length;f++){d=c('<li><a href="#">'+e[f].item_caption+'</a></li>');d.find('a').data('report',e[f]);d.on('click','a',function(){c(this).data('report').print_report();});b.append(d);}}else a.view_form.find("#report-btn").hide();}else a.view_form.find("#report-btn").hide();}function o(a){var b,c;if(a.item_name==='sys_fields_editor'||a.item_name==='sys_code_editor')return;a.auto_loading=false;if(a.view_form.hasClass('modal')){a.view_form.find("#select-btn").on('click.task',function(){a.set_lookup_field_value();});a.view_form.modal_width=960;c=480;if(a.item_name==='sys_items'||a.item_name==='sys_fields'){a.view_form.modal_width=560;a.view_form.find('.modal-footer').hide();b={id:'10%'};}if(a.item_name==='sys_filters'||a.item_name==='sys_report_params'||a.item_name==='sys_indices'){a.view_form.modal_width=680;c=460;}}else{if(a.task.cur_item){a.task.cur_item.close_view_form();a.task.cur_item=a;}a.view_form.find(".modal-body").css('padding',0);a.view_form.find(".view-title").html('<h4>'+a.task.cur_item_title+'</h4>');a.view_form.find("#select-btn").hide();c=task.center_panel.height()-task.view_panel.height();}if(a.item_name==='sys_items')b={id:'5%',f_visible:'10%',f_soft_delete:'10%'};if(a.item_name==='sys_report_params'){a.set_view_fields(['f_name','f_param_name','f_data_type','f_object','f_object_field','f_required','f_visible','f_alignment']);a.set_edit_fields(['f_name','f_param_name','f_data_type','f_object','f_object_field','f_required','f_visible','f_alignment']);}if(a.item_name!=="sys_roles"){a.view_form.find("#new-btn").text(a.task.language['new']).on('click.task',function(){a.append_record();});a.view_form.find("#edit-btn").text(a.task.language.edit).on('click.task',function(){a.edit_record();});a.view_form.find("#delete-btn").text(a.task.language['delete']).on('click.task',function(){a.delete_record();});if(a.init_view_table)a.init_view_table(a);a.view_table=a.create_table(a.view_form.find(".view-table"),{height:c,word_wrap:false,column_width:b});}n(a);}function p(a){a.find(".modal-footer button.btn").each(function(){if(c(this).outerWidth()<100&&c(this).text())c(this).outerWidth(100);});}function q(a){p(a.view_form);if(a.item_name==='sys_fields_editor'||a.item_name==='sys_code_editor')return;if(a.item_name==='sys_items')a.open({fields:['id','deleted','parent','task_id','type_id','table_id','has_children','f_index','f_name','f_item_name','f_table_name','f_view_template','f_edit_template','f_filter_template','f_visible','f_soft_delete']});else a.open();}function r(a){if(a.item_name!=='sys_items'&&a.item_name!=='sys_code_editor'){a.edit_form.modal_width=560;a.create_inputs(a.edit_form.find(".edit-body"));a.edit_form.find("#cancel-btn").text(a.task.language.cancel).attr("tabindex",101).on('click.task',function(b){a.cancel_edit(b);return false;});a.edit_form.find("#ok-btn").attr("tabindex",100).text(a.task.language.ok).on('click.task',function(){a.apply_record();});}}function s(a){p(a.edit_form);if(a.details_active)a.eachDetail(function(a){a.update_controls();});else a.open_details();I(a);}function t(a){if(a.item_name!=='sys_search')if(a.is_changing())if(a.modified){a.yesNoCancel(task.language.save_changes,function(){a.apply_record();},function(){a.cancel_edit();});return false;}else{a.cancel();return true;}}function u(a){a.filter_form.title=a.item_caption+' - filter';a.create_filter_inputs(a.filter_form.find(".edit-body"));a.filter_form.find("#cancel-btn").attr("tabindex",101).on('click.task',function(){a.close_filter();});a.filter_form.find("#ok-btn").attr("tabindex",100).on('click.task',function(){a.apply_filter();});}function v(a){a.create_param_inputs(a.params_form.find(".edit-body"));a.params_form.find("#cancel-btn").attr("tabindex",101).on('click.task',function(){a.close_params_form();});a.params_form.find("#ok-btn").attr("tabindex",100).on('click.task',function(){a.process_report();});}function w(a,b){a.sys_params.set_edit_fields(['f_safe_mode','f_debugging','f_con_pool_size','f_version']);a.sys_params.item_caption=b;a.sys_params.edit_record();}function x(a,b){var c=['f_decimal_point','f_mon_decimal_point','f_mon_thousands_sep','f_currency_symbol','f_frac_digits','f_p_cs_precedes','f_n_cs_precedes','f_p_sep_by_space','f_n_sep_by_space','f_positive_sign','f_negative_sign','f_p_sign_posn','f_n_sign_posn','f_d_fmt','f_d_t_fmt'];a.sys_params.set_edit_fields(c);a.sys_params.item_caption=b;a.sys_params.edit_record();}function y(a,b){var c=['f_manual_update','f_db_type','f_alias','f_login','f_password','f_host','f_port','f_encoding'];a.sys_tasks.on_field_changed(a.sys_tasks.f_db_type);a.sys_tasks.set_edit_fields(c);a.sys_tasks.f_name.required=false;a.sys_tasks.f_item_name.required=false;a.sys_tasks.item_caption=b;a.sys_tasks.edit_record();}function z(a){a.sys_search.find_in_task(a);}function A(a,b){var d,e,f,g,h=0,i,j;for(d=0;d<a.length;d++){b.append(c('<h4>'+a[d][0]+'</h4>'));i=a[d][1].split('\n');for(e=0;e<i.length;e++){g=i[e];h=0;for(f=0;f<g.length;f++)if(g[f]===' ')h+=1;else if(g[f]==='\t ')h+=4;else break;g=g.trim();if(g.length===0)j=c('<p style="line-height: 16px; margin: 0px;">').html('&nbsp;');else j=c('<p style="line-height: 16px; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: '+h*6+'px">').text(g);j.css("font-family","'Courier New', Courier, monospace");b.append(j);}}}function B(d){var e=c(a).width()-50,f=c(a).height()-200,g=c('<div>'),h=d.server_function('server_web_print_code',[d.sys_tasks.task_id.value]);if(h){g.append(c('<h2>'+h.task+'</h2>'));g.append(c('<h3>Client</h3>'));A(h.client,g);g.append(c('<h3>Server</h3>'));A(h.server,g);d.information(g,{title:'Project code',margin:10,width:e,height:f,text_center:false,buttons:{"Close":b},center_buttons:false,print:true});}}function C(a,b){var c=a.server_function('server_import_task',[a.sys_tasks.task_id.value,'static/internal/'+b]);if(c)a.warning(c);}function D(a){a.upload('static/internal',{multiple:false,callback:C});}function E(b){var c,d=location.protocol+'/'+'/'+location.hostname+(location.port?':'+location.port:''),e=b.server_function('server_export_task',[b.sys_tasks.task_id.value,d]);a.open(e,"_self");}function F(a,b,c){var d=a._records[b],e=a._records[c],f,g;for(f=0;f<d.length-1;f++){g=d[f];d[f]=e[f];e[f]=g;}a.update_controls();a.rec_no=c;}function G(a){if(a.rec_no>0)F(a,a.rec_no,a.rec_no-1);}function H(a){if(a.rec_no<a.record_count()-1)F(a,a.rec_no,a.rec_no+1);}function I(b,d){var e,f,g;if(b.edit_form&&b.edit_table){e=b.edit_form.height();f=c(a).height();if(d||e>f-20){g=b.edit_table.height()-(e-f)-20;if(g>450)g=450;if(g<200)g=200;b.edit_table.height(g);b.edit_table.resize();}}}var J;function K(b){clearTimeout(J);J=setTimeout(function(){var d=b.left_panel.height()+c(a).height()-c('body').height()-40;b.left_panel.height(d);b.tree.height(d);b.btns_panel.height(d);},100);}function L(a,b){if(a.item_name==='sys_users'||a.item_name==='sys_report_params'||a.item_name==='sys_filters')if(b.keyCode===45&&b.ctrlKey===true){b.preventDefault();a.insert_record();}else if(b.keyCode===46&&b.ctrlKey===true){b.preventDefault();a.delete_record();}}function M(a,b){if(a.item_name==='sys_users'||a.item_name==='sys_indices'||a.item_name==='sys_report_params'||a.item_name==='sys_filters')if(b.keyCode===13&&b.ctrlKey===true){b.preventDefault();a.edit_form.find("#ok-btn").focus();a.apply_record();}}this.tree_changed=f;this.refresh_tree=g;this.on_page_loaded=h;this.read_task_name=i;this.add_button=j;this.add_divider=k;this.add_buttons=l;this.create_params_btn=m;this.create_print_btns=n;this.on_before_show_view_form=o;this.expand_buttons=p;this.on_after_show_view_form=q;this.on_before_show_edit_form=r;this.on_after_show_edit_form=s;this.on_edit_form_close_query=t;this.on_before_show_filter_form=u;this.on_before_show_params_form=v;this.set_project_params=w;this.set_locale_params=x;this.edit_database=y;this.find_in_task=z;this.print_section=A;this.print_code=B;this.do_import=C;this.import_task=D;this.export_task=E;this.move_vert=F;this.move_record_up=G;this.move_record_down=H;this.resize_edit_table=I;this.resize=K;this.on_view_keydown=L;this.on_edit_keydown=M;}a.task_events.events0=new e();function f(){function a(a){var b=a.task;if(b.item_tree.type_id.value===b.item_types.TASKS_TYPE){a.set_view_fields(['id','f_name','f_item_name'],['ID',b.language.caption,b.language.name]);a.set_edit_fields(['f_name','f_item_name'],[b.language.caption,b.language.name]);b.add_buttons(b,['client_module','server_module','index.html','project.css']);return true;}}function c(a){var b=a.task;if(b.item_tree.type_id.value===b.item_types.TASK_TYPE){a.fields_editor=true;a.set_view_fields(['id','f_name','f_item_name'],['ID',b.language.caption,b.language.name]);a.set_edit_fields(['f_name','f_item_name'],[b.language.caption,b.language.name]);a.sys_fields.set_view_fields(['f_name','f_field_name','f_data_type','f_size','f_object','f_object_field','f_master_field','f_required','f_default','f_read_only','f_alignment'],[b.language.caption,b.language.name,b.language.data_type,b.language.size,b.language.object,b.language.object_field,b.language.master_field,b.language.required,b.language['default'],b.language.read_only,b.language.alignment]);a.sys_fields.set_edit_fields(['f_name','f_field_name','f_data_type','f_size','f_object','f_object_field','f_master_field','f_required','f_default','f_read_only','f_alignment'],[b.language.caption,b.language.name,b.language.data_type,b.language.size,b.language.object,b.language.object_field,b.language.master_field,b.language.required,b.language['default'],b.language.read_only,b.language.alignment]);b.add_buttons(b,['client_module','server_module']);return true;}}function d(a){var b=a.task;if(b.item_tree.type_id.value===b.item_types.CATALOGS_TYPE||b.item_tree.type_id.value===b.item_types.JOURNALS_TYPE||b.item_tree.type_id.value===b.item_types.TABLES_TYPE){a.fields_editor=true;a.set_view_fields(['id','f_name','f_item_name','f_table_name','f_visible','f_soft_delete'],['ID',b.language.caption,b.language.name,b.language.table_name,b.language.visible,'Soft delete']);a.set_edit_fields(['f_name','f_item_name','f_visible','f_soft_delete','f_table_name'],[b.language.caption,b.language.name,b.language.visible,'Soft delete',b.language.table_name]);a.sys_fields.set_view_fields(['f_name','f_field_name','f_data_type','f_size','f_object','f_object_field','f_master_field','f_required','f_default','f_read_only','f_alignment'],[b.language.caption,b.language.name,b.language.data_type,b.language.size,b.language.object,b.language.object_field,b.language.master_field,b.language.required,b.language['default'],b.language.read_only,b.language.alignment]);a.sys_fields.set_edit_fields(['f_name','f_field_name','f_data_type','f_size','f_object','f_object_field','f_master_field','f_required','f_default','f_read_only','f_alignment'],[b.language.caption,b.language.name,b.language.data_type,b.language.size,b.language.object,b.language.object_field,b.language.master_field,b.language.required,b.language['default'],b.language.read_only,b.language.alignment]);b.add_buttons(b,['client_module','server_module','divider','viewing','editing','filters','divider','details','divider','order','indices','foreign_keys','divider','reports']);return true;}}function e(a){var b=a.task;if(b.item_tree.type_id.value===b.item_types.CATALOG_TYPE||b.item_tree.type_id.value===b.item_types.JOURNAL_TYPE||b.item_tree.type_id.value===b.item_types.TABLE_TYPE){a.set_view_fields(['id','f_name','f_item_name','f_table_name'],['ID',b.language.caption,b.language.name,b.language.table_name]);a.set_edit_fields(['f_name','f_item_name'],[b.language.caption,b.language.name]);b.add_buttons(b,['client_module','server_module','divider','viewing','editing','divider','order']);return true;}}function f(a){var b=a.task;if(b.item_tree.type_id.value===b.item_types.REPORTS_TYPE){a.set_view_fields(['id','f_name','f_item_name','f_view_template','f_visible'],['ID',b.language.caption,b.language.name,b.language.template,b.language.visible]);a.set_edit_fields(['f_name','f_item_name','f_view_template','f_visible'],[b.language.caption,b.language.name,b.language.template,b.language.visible]);b.add_buttons(b,['client_module','server_module','divider','report_params']);return true;}}function g(b){b.fields_editor=false;return a(b)||c(b)||d(b)||e(b)||f(b);}function h(a){var b=a.task,c=a.task.item_tree,d;a.filters.parent.value=c.id.value;g(a);a.view(b.view_panel);}function i(a){var b=a.task.item_tree.type_id.value,c=a.task.item_types,d=a.task;if(b===c.TASKS_TYPE)return c.TASK_TYPE;else if(b===c.CATALOGS_TYPE)return c.CATALOG_TYPE;else if(b===c.JOURNALS_TYPE)return c.JOURNAL_TYPE;else if(b===c.TABLES_TYPE)return c.TABLE_TYPE;else if(b===c.REPORTS_TYPE)return c.REPORT_TYPE;else if(b===c.CATALOG_TYPE||b===c.JOURNAL_TYPE||b===c.TABLE_TYPE)return c.DETAIL_TYPE;}function j(a){var b=0,c=a.rec_no;try{a.each(function(a){a.edit();a.f_index.value=b;a.post();b++;});a.apply();}finally{a.rec_no=c;}}function k(a){a.view_form.find('#up-btn').click(function(){a.task.move_record_up(a);j(a);});a.view_form.find('#down-btn').click(function(){a.task.move_record_down(a);j(a);});}function l(a){var b=1,c=560,d=a.task.item_tree;if(a.fields_editor){b=1;c=1050;}a.edit_form.title=a.f_name.value;a.edit_form.modal_width=c;if(a.fields_editor)a.create_inputs(a.edit_form.find(".field-container"),{col_count:b});else a.create_inputs(a.edit_form.find(".edit-body"),{col_count:b});a.edit_form.find("#cancel-btn").attr("tabindex",101).on('click.task',function(b){a.cancel_edit(b);return false;});a.edit_form.find("#ok-btn").attr("tabindex",100).on('click.task',function(){a.apply_record();});if(a.item_name==='sys_items')if(a.fields_editor){a.edit_table=a.sys_fields.create_table(a.edit_form.find(".edit-detail"),{height:400,tabindex:90,sortable:true});a.edit_form.find("#new-btn").attr("tabindex",92).on('click.task',function(){a.sys_fields.append_record();});a.edit_form.find("#edit-btn").attr("tabindex",91).on('click.task',function(){a.sys_fields.edit_record();});a.edit_form.find("#delete-btn").attr("tabindex",90).on('click.task',function(){a.sys_fields.delete_record();});}else a.edit_form.find('#edit-detail-footer').hide();}function m(a){a.f_visible.value=true;a.f_soft_delete.value=true;a.parent.value=a.task.item_tree.id.value;a.task_id.value=a.task.item_tree.task_id.value;a.table_id.value=0;a.f_index.value=a.record_count();a.type_id.value=i(a);}function n(a){var c=a.owner,d,e,f,g,h;if(a.field_name==='f_item_name'){if(!c.valid_identifier(a.value))return c.task.language.invalid_name;if(c.type_id.value!==c.task.item_types.DETAIL_TYPE){d=c.copy({details:false,handlers:false});d.open();d.each(function(b){if(b.id.value!==c.id.value&&b.type_id.value!=c.task.item_types.DETAIL_TYPE)if(b.f_item_name.value===a.value){h='There is an item with this name';return false;}});if(h)return h;e=new c.task.constructors.item();if(e[a.value]!==b)return c.task.language.reserved_word;f=new c.task.constructors.group();if(f[a.value]!==b)return c.task.language.reserved_word;g=new c.task.constructors.task();if(g[a.value]!==b)return c.task.language.reserved_word;}else{d=c.copy({details:false,handlers:false});d.set_where(parent=c.parent.value);d.open();d.each(function(b){if(b.id.value!==c.id.value)if(b.f_item_name.value===a.value)return 'There is an item with this name';});e=new c.task.constructors.item();if(e[a.value]!==b)return c.task.language.reserved_word;}}}function o(a,b){var c,d,e=a.owner;if(e.is_new()&&e.type_id.value===e.task.item_types.CATALOG_TYPE||e.type_id.value===e.task.item_types.JOURNAL_TYPE||e.type_id.value===e.task.item_types.TABLE_TYPE||e.type_id.value===e.task.item_types.REPORT_TYPE){if(a.field_name=='f_item_name'){c=e.copy({handlers:false,details:false});c.set_where({type_id:e.task.item_types.TASK_TYPE});c.open();if(c.record_count()===1)e.f_table_name.value=c.f_item_name.value+'_'+a.value;}if(a.field_name==='f_name'&&!e.f_item_name.value)try{d=a.text.replace(' ','_').toLowerCase();if(p(d))e.f_item_name.value=d;}catch(f){}}}function p(a){function b(a){return a.charCodeAt(0)>=97&&a.charCodeAt(0)<=122;}function c(a){return a.charCodeAt(0)>=48&&a.charCodeAt(0)<=57;}var d,e=a.length;if(a[0]==='_'||b(a[0])){for(d=1;d<e;d++)if(!(a[d]==='_'||b(a[d])||c(a[d])))return false;return true;}return false;}function q(a){var b;clearTimeout(b);b=setTimeout(function(){a.f_table_name.read_only=!a.is_new();task.btns_panel.find('button').prop("disabled",a.record_count()===0);},100);}function r(a){var b='';if(a.type_id.value===a.task.item_types.CATALOGS_TYPE||a.type_id.value===a.task.item_types.JOURNALS_TYPE||a.type_id.value===a.task.item_types.TABLES_TYPE){b=a.task.language.cant_delete_group;a.warning(b);return false;}if(a.id.value){b=a.server_function('server_can_delete',[a.id.value]);if(b){a.warning(b);return false;}}}function s(a){var b=a.sys_items,c=b.copy(),d=b.task.sys_fields.copy(),e,f=[];if(b.table_id.value===0)d.set_where({owner_rec_id__in:[b.id.value,b.parent.value]});else{c.set_where({id:b.table_id.value});c.open({fields:['id','parent']});e=c.parent.value;d.set_where({owner_rec_id__in:[b.table_id.value,e]});}d.open({fields:['id','f_field_name']});d.each(function(a){f.push([a.id.value,a.f_field_name.value]);});return f;}function t(a){var b,c=[],d=[],e,f;function g(a,c){b.view_list=c;a.server_function('server_store_interface',[a.id.value,b]);}b=a.server_function('server_load_interface',[a.id.value]);c=[['id','',false],['name',a.task.language.caption_name,true]];d=[['id','',false],['name',a.task.language.caption_name,true,'60%'],['param1',a.task.language.caption_word_wrap,false],['param2',a.task.language.caption_expand,false],['param3',a.task.language.caption_edit,false]];f=a.f_name.value+' - '+a.task.language.viewing;a.task.sys_fields_editor.fields_editor(a,f,c,s(a.task),d,b.view_list,g);}function u(a){var b,c=[],d=[],e,f;function g(a,c){b.edit_list=c;a.server_function('server_store_interface',[a.id.value,b]);}b=a.server_function('server_load_interface',[a.id.value]);c=[['id','',false],['name',a.task.language.caption_name,true]];d=[['id','',false],['name',a.task.language.caption_name,true]];f=a.f_name.value+' - '+a.task.language.editing;a.task.sys_fields_editor.fields_editor(a,f,c,s(a.task),d,b.edit_list,g);}function v(a,b){a.task.sys_code_editor.code_editor(a,b);}function w(a,b){a.task.sys_code_editor.file_editor(a,b);}function x(a){v(a,'f_web_client_module');}function y(a){v(a,'f_server_module');}function z(a){w(a,'index.html');}function A(a){w(a,'css/project.css');}function B(a){var b=[],c=a.copy({handlers:false});c.set_where({type_id:task.item_types.TABLE_TYPE});c.open();c.each(function(a){b.push([a.id.value,a.f_item_name.value]);});return b;}function C(a){var b=[],c=a.copy({handlers:false});c.set_where({parent:a.id.value});c.open();c.each(function(a){b.push([a.table_id.value]);});return b;}function D(a){var c,d=[],e=[],f=B(a),g=C(a),h;function i(a,b){if(JSON.stringify(g)!==JSON.stringify(b)){a.server_function('server_update_details',[a.id.value,b]);a.task.refresh_tree(a.task);}}d=[['id','',false],['name',a.task.language.caption_name,true]];e=[['id','',false],['name',a.task.language.caption_name,true]];h=a.f_name.value+' - '+a.task.language.details;a.task.sys_fields_editor.fields_editor(a,h,d,f,e,g,i,b,false);}function E(a){var b,c=[],d=[],e,f;function g(a,c){b.order_list=c;a.server_function('server_store_interface',[a.id.value,b]);}b=a.server_function('server_load_interface',[a.id.value]);c=[['id','',false],['name',a.task.language.caption_name,true]];d=[['id','',false],['name',a.task.language.caption_name,true,'80%'],['param1',a.task.language.caption_descening,true]];f=a.f_name.value+' - '+a.task.language.order;a.task.sys_fields_editor.fields_editor(a,f,c,s(a.task),d,b.order_list,g);}function F(a){var b,c=[],d=a.copy({handlers:false});d.set_where({type_id:a.task.item_types.REPORTS_TYPE});d.open();b=d.id.value;d.set_where({parent:b});d.open();d.each(function(a){c.push([a.id.value,a.f_name.value]);});return c;}function G(a){var b,c=[],d=[],e,f;function g(a,c){b.reports_list=c;a.server_function('server_store_interface',[a.id.value,b]);}b=a.server_function('server_load_interface',[a.id.value]);c=[['id','',false],['name',a.task.language.caption_name,true]];d=[['id','',false],['name',a.task.language.caption_name,true]];f=a.f_name.value+' - '+a.task.language.reports;a.task.sys_fields_editor.fields_editor(a,f,c,F(a),d,b.reports_list,g);}function H(a){a.task.sys_filters.filters.owner_rec_id.value=a.id.value;a.task.sys_filters.open();a.task.sys_filters.set_view_fields(['f_name','f_filter_name','f_type','f_field','f_visible']);a.task.sys_filters.set_edit_fields(['f_field','f_name','f_filter_name','f_type','f_visible']);a.task.sys_filters.view_modal();}function I(a){a.task.sys_indices.filters.owner_rec_id.value=a.id.value;a.task.sys_indices.filters.foreign_index.value=false;a.task.sys_indices.open();a.task.sys_indices.view_modal();}function J(a){a.task.sys_indices.filters.owner_rec_id.value=a.id.value;a.task.sys_indices.filters.foreign_index.value=true;a.task.sys_indices.open();a.task.sys_indices.view_modal();}function K(a){a.task.sys_report_params.filters.owner_rec_id.value=a.id.value;a.task.sys_report_params.open();a.task.sys_report_params.set_view_fields(['f_name','f_param_name','f_data_type','f_object','f_object_field','f_required','f_alignment']);a.task.sys_report_params.set_edit_fields(['f_name','f_param_name','f_data_type','f_object','f_object_field','f_required','f_alignment']);a.task.sys_report_params.view_modal();}function L(a,b){if(b.keyCode===45&&b.ctrlKey===true){b.preventDefault();a.insert_record();}else if(b.keyCode===46&&b.ctrlKey===true){b.preventDefault();a.delete_record();}}function M(a,b){if(b.keyCode===13&&b.ctrlKey===true){b.preventDefault();a.edit_form.find("#ok-btn").focus();a.apply_record();}if(b.keyCode===45&&b.ctrlKey===true){b.preventDefault();a.sys_fields.append_record();}else if(b.keyCode===46&&b.ctrlKey===true){b.preventDefault();a.sys_fields.delete_record();}}this.init_task=a;this.init_groups=c;this.init_items=d;this.init_details=e;this.init_reports=f;this.init=g;this.tree_changed=h;this.get_type_id=i;this.save_order=j;this.on_before_show_view_form=k;this.on_before_show_edit_form=l;this.on_after_append=m;this.on_field_validate=n;this.on_field_changed=o;this.valid_identifier=p;this.on_after_scroll=q;this.on_before_delete=r;this.get_fields_list=s;this.view_setup=t;this.edit_setup=u;this.edit_code=v;this.edit_file=w;this.edit_client=x;this.edit_server=y;this.edit_index_html=z;this.edit_project_css=A;this.get_detail_source_list=B;this.get_detail_dest_list=C;this.details_setup=D;this.order_setup=E;this.get_reports_list=F;this.reports_setup=G;this.filters_setup=H;this.indices_setup=I;this.foreign_keys_setup=J;this.report_params_setup=K;this.on_view_keydown=L;this.on_edit_keydown=M;}a.task_events.events3=new f();function g(){function a(a){a.set_view_fields(['f_login','f_password','f_role','f_admin'],[a.task.language.login,a.task.language.password,a.task.language.role,'Admin']);}this.init_view_table=a;}a.task_events.events1=new g();function h(){function a(a){var b=a.task.center_panel.height()-a.task.view_panel.height();if(a.view_form.hasClass('modal')){b=460;a.view_form.modal_width=560;a.view_form.find("#priv-panel").remove();a.view_form.find("#roles-panel").removeClass('span4').addClass('span12');a.view_form.find("#roles-footer").hide();a.view_table=a.create_table(a.view_form.find("#roles-panel .view-table"),{height:b,fields:['id','f_name'],column_width:{id:'10%'}});}else{a.details_active=true;a.view_form.find("#roles-panel #new-btn").text(a.task.language['new']).on('click.task',function(){g(a);});a.view_form.find("#roles-panel #delete-btn").text(a.task.language['delete']).on('click.task',function(){f(a);});a.view_form.find("#select-all-btn").text(a.task.language.select_all).on('click.task',function(){d(a);});a.view_form.find("#unselect-all-btn").text(a.task.language.unselect_all).on('click.task',function(){e(a);});a.set_view_fields(['f_name'],[a.task.language.roles]);a.view_table=a.create_table(a.view_form.find("#roles-panel .view-table"),{height:b,fields:['id','f_name'],word_wrap:false,sortable:false});a.sys_privileges.set_view_fields(['item_id','f_can_view','f_can_create','f_can_edit','f_can_delete'],[a.task.language.item,a.task.language.can_view,a.task.language.can_create,a.task.language.can_edit,a.task.language.can_delete]);a.detail_table=a.sys_privileges.create_table(a.view_form.find("#priv-panel .view-table"),{height:b,word_wrap:true,column_width:{item_id:'50%'},sortable:false,dblclick_edit:false});a.detail_table.$table.on('click','td',function(){var b=c(this),d=b.data('field_name'),e=a.sys_privileges.field_by_name(d);if(e.field_type==="boolean"){if(!a.sys_privileges.is_changing())a.sys_privileges.edit();e.value=!e.value;}});}}function d(a,c){var d=a.details.sys_privileges,e=d.on_field_changed,f=d.rec_no;if(c===b)c=true;if(!a.is_changing())a.edit();try{d.on_field_changed=b;d.disable_controls();d.each(function(b){b.edit();b.f_can_create.value=c;b.f_can_view.value=c;b.f_can_edit.value=c;b.f_can_delete.value=c;if(b.id.value)b.record_status=a.task.consts.RECORD_MODIFIED;else b.record_status=a.task.consts.RECORD_INSERTED;b.post();});}finally{d.on_field_changed=e;d.rec_no=f;d.enable_controls();}if(a.is_changing()){a.post();a.apply();a.edit();}d.open();}function e(a){d(a,false);}function f(a){if(a.is_changing())a.cancel();a.delete_record();}function g(a){if(a.is_changing()){a.post();a.apply();}a.append_record();}function h(a){if(a.is_changing()){a.post();a.apply();}}function i(a){if(a.is_browsing())a.edit();}this.on_before_show_view_form=a;this.select_all_clicked=d;this.unselect_all_clicked=e;this.del_role=f;this.append_role=g;this.on_before_scroll=h;this.on_after_scroll=i;}a.task_events.events2=new h();function i(){function a(a){if(task.init_project&&a.f_db_type.value)a.task.on_page_loaded(a.task);}function b(a,b){var c=a.owner,d;if(a==a.owner.f_db_type){d=c.task.server_function('server_get_db_options',[a.owner.f_db_type.value]);if(a.owner.is_changing()){a.owner.f_alias.value=null;a.owner.f_login.value=null;a.owner.f_password.value=null;a.owner.f_encoding.value=null;a.owner.f_host.value=null;a.owner.f_port.value=null;}a.owner.f_login.read_only=!d.NEED_DATABASE_NAME;a.owner.f_login.read_only=!d.NEED_LOGIN;a.owner.f_password.read_only=!d.NEED_PASSWORD;a.owner.f_encoding.read_only=!d.NEED_ENCODING;a.owner.f_host.read_only=!d.NEED_HOST;a.owner.f_port.read_only=!d.NEED_PORT;}}function c(a){var b=a.task.server_function('server_check_connection',[a.f_db_type.value,a.f_alias.value,a.f_login.value,a.f_password.value,a.f_host.value,a.f_port.value,a.f_encoding.value]);if(b){a.warning(b);return false;}if(task.init_project)a.task.server_function('server_set_task_name',[a.f_name.value,a.f_item_name.value]);}this.on_after_apply=a;this.on_field_changed=b;this.on_before_post=c;}a.task_events.events9=new i();function j(){function d(a,b){var c=this.copy();c.item=a;c.field_name=b;c.is_server=b==='f_server_module';c.item_info=a.task.server_function('server_item_info',[a.task.sys_items.id.value,c.is_server]);c.view_modal();}function e(a,b){var c=this.copy();c.item=a;c.file_name=b;c.item_info=a.task.server_function('server_get_file_info',[b]);c.view_modal();}function f(a){task.code_editor_item=a;a.view_form.find("#left-box").width(250);a.view_form.find("#right-box").hide();a.view_form.find("#cancel-btn").attr("tabindex",101).on('click',function(b){n(a);});a.view_form.find("#ok-btn").attr("tabindex",100).on('click',function(){m(a);});a.view_form.find("#icon-search").attr("tabindex",99).on('click',function(){u(a);});o(a);}function g(a){if(a.field_name){a.view_form.find('h4.modal-title').text('Editor '+a.item_info.module_name);a.view_form.find('#editor-tabs ul').append('<li id="module"><a href="#">Module</a></li>').append('<li id="events"><a href="#">Events</a></li>').append('<li id="task"><a href="#">Task</a></li>').append('<li id="fields"><a href="#">Fields</a></li>');s(a,"Module");s(a,"Events");s(a,"Task");s(a,"Fields");a.view_form.find('#editor-tabs #info-grids').height(a.view_form.find('#left-box').innerHeight()-a.view_form.find('ul.nav-tabs').outerHeight()-14);r(a,a.view_form.find('li#module'));a.editor=ace.edit("editor");a.editor.$blockScrolling=Infinity;c(a.editor).focus();if(a.is_server){a.is_server_module=true;a.editor.getSession().setMode("ace/mode/python");a.editor.getSession().setUseSoftTabs(true);}else a.editor.getSession().setMode("ace/mode/javascript");}else if(a.file_name){a.view_form.find('h4.modal-title').text('Editor '+a.file_name);if(a.item_info.Templates){a.view_form.find('#editor-tabs ul').append('<li id="templates"><a href="#">Templates</a></li>');s(a,"Templates");a.view_form.find('#editor-tabs #info-grids').height(a.view_form.find('#left-box').innerHeight()-a.view_form.find('ul.nav-tabs').outerHeight()-14);r(a,a.view_form.find('li#templates'));}else a.view_form.find("#left-box").hide();a.editor=ace.edit("editor");a.editor.$blockScrolling=Infinity;c(a.editor).focus();if(a.file_name==='index.html')a.editor.getSession().setMode("ace/mode/html");else a.editor.getSession().setMode("ace/mode/css");}a.loaded=true;a.editor.session.setValue(a.item_info.code);a.editor.gotoLine(1);a.view_form.find('#ok-btn').prop("disabled",true);a.editor.on('input',function(){if(a.loaded){a.loaded=false;i(a);return;}if(h(a))a.view_form.find('#ok-btn').prop("disabled",false);else a.view_form.find('#ok-btn').prop("disabled",true);});a.view_form.on('click','#editor-tabs > .nav > li',function(){r(a,c(this));});a.view_form.on('dblclick','.treeview ul li',function(b){b.preventDefault();b.stopPropagation();p(a,c(this));});setTimeout(function(){a.view_form.off('keyup.dismiss.modal');},100);}function h(a){return !a.editor.session.getUndoManager().isClean();}function i(a){a.editor.session.getUndoManager().markClean();}function j(a){if(h(a)){a.yesNoCancel(task.language.save_changes,function(){m(a);a.close_view_form();},function(){i(a);a.close_view_form();});return false;}else{task.code_editor_item=b;a.editor.destroy();return true;}}function k(a){var b=a.task.server_function('server_save_edit',[a.task.sys_items.id.value,a.editor.getValue(),a.is_server]),c=b[0],d=b[1],e=b[2];if(c&&d&&d<a.editor.session.getLength())a.editor.gotoLine(d);if(!c){a.item_info.Module=e;s(a,"Module");q(a);}return c;}function l(a){var b=a.task.server_function('server_save_file',[a.file_name,a.editor.getValue()]),c=b.error;if(b.Templates){a.item_info.Templates=b.Templates;s(a,"Templates");q(a);}}function m(a){var b=false;if(a.field_name)b=k(a);else if(a.file_name)b=l(a);if(b)a.view_form.find("#error-info").text(b);else{a.view_form.find("#error-info").text('');i(a);a.view_form.find('#ok-btn').prop("disabled",true);}}function n(a){i(a);a.close_view_form();}function o(b){var d;b.view_form.modal_width=c(a).width()-50;d=c(a).height()-200;b.view_form.find("#editor-box").height(d);}function p(a,b){var c=b.closest('.info-tree').attr('id'),d=b.find('span.tree-text:first').text(),e,f;if(c==='module'){a.editor.gotoLine(1);if(a.is_server_module)e='def '+d;else e='function '+d;a.editor.find(e,{backwards:false,wrap:false,caseSensitive:true,wholeWord:true,regExp:false});}else if(c==='events'){a.editor.gotoLine(a.editor.session.getLength()+1);f=a.item_info.Events[d];if(a.is_server_module)e='def '+d+'('+f+'):\n\tpass';else e='function '+d+'('+f+') {\n\n}';a.editor.insert('\n\n'+e);}else if(c==='task'||c==='fields')a.editor.insert(d);else if(c==='templates'){a.editor.gotoLine(1);e=d;a.editor.find(e,{backwards:false,wrap:false,caseSensitive:true,wholeWord:true,regExp:false});}a.editor.focus();}function q(a){var b,c,d;b=a.view_form.find('#editor-tabs > .nav > li.active');if(b.length){d=a.view_form.find('#editor-tabs #info-grids').innerHeight();a.view_form.find('#editor-tabs div.info-tree').hide();a.view_form.find('#editor-tabs div.info-tree.'+b.attr('id')).show().height(d).find('.treeview').height(d);c=a.view_form.find('#editor-tabs div.info-tree.'+b.attr('id')).find('.treeview').data('tree');if(c)c.scroll_into_view();}}function r(a,b){var c;a.view_form.find('#editor-tabs li').removeClass('active');b.addClass('active');q(a);}function s(a,b){var d=a.copy(),e=b.toLowerCase(),f=a.view_form.find('li#'+e),g=a.item_info[b],h;h=a.view_form.find('#editor-tabs #info-grids > div.'+e);if(h.length)h.empty();else{h=c('<div id="'+e+'" class="info-tree '+e+'">');a.view_form.find('#editor-tabs #info-grids').append(h);}h.hide();d.open({open_empty:true});t(d,g,0);d.disable_controls();try{d.create_tree(h,{id_field:'id',parent_field:'parent',text_field:'name',parent_of_root_value:0});}finally{d.enable_controls();}}function t(a,b,c){var d=[],e=0;for(var f in b)d.push(f);d=d.sort();e=c+1;if(d.length)for(var g=0;g<d.length;g++){a.append();a.id.value=e;a.parent.value=c;a.name.value=d[g];a.post();if(b[d[g]]!==null&&typeof b[d[g]]==='object')e=t(a,b[d[g]],e);e++;}return e;}function u(a){a.task.sys_search.find_in_task(task);}function v(a,b){var c=(b.keyCode?b.keyCode:b.which);if(c===27)if(!a.view_form.find('.ace_search').is(':visible'))a.close_view_form();if(b.ctrlKey&&c===83){b.preventDefault();b.stopPropagation();m(a);}if(b.altKey&&c===70){b.preventDefault();b.stopPropagation();u(a);}}this.code_editor=d;this.file_editor=e;this.on_before_show_view_form=f;this.on_after_show_view_form=g;this.is_modified=h;this.mark_clean=i;this.on_view_form_close_query=j;this.save_to_field=k;this.save_to_file=l;this.save_edit=m;this.cancel_edit=n;this.update_size=o;this.tree_node_clicked=p;this.update_tab_height=q;this.info_tab_clicked=r;this.add_tree=s;this.build_tree=t;this.find_in_project=u;this.on_view_keydown=v;}a.task_events.events14=new j();function k(){function a(a,c,d,e,f,g,h,i,j,k){var l=this.copy();l.item=a;l.title=c;l.source_def=d;l.source_list=e;l.dest_def=f;l.dest_list=g;l.save_func=h;l.cancel_func=i;if(j===b)j=true;l.can_move=j;if(k===b)k=false;l.read_only=k;l.view_modal();return l;}function d(a){var b={},d,e;if(a.dest_def[1].length===4)b={'name':a.dest_def[1][3]};a.source=a.copy(),a.dest=a.copy();a.view_form.modal_width=680;a.view_form.title=a.title;e=[];for(d=0;d<a.source_def.length;d++)if(a.source_def[d][2])e.push(a.source_def[d][0]);a.source.set_view_fields(e);e=[];for(d=0;d<a.dest_def.length;d++)if(a.dest_def[d][2])e.push(a.dest_def[d][0]);a.dest.set_view_fields(e);a.left_grid=a.dest.create_table(a.view_form.find("#left-grid"),{height:360,column_width:b});a.right_grid=a.source.create_table(a.view_form.find("#right-grid"),{height:360});a.left_grid.$table.keydown(function(b){var c=(b.keyCode?b.keyCode:b.which);if(c===32){b.preventDefault();i(a);}});a.right_grid.$table.keydown(function(b){var c=(b.keyCode?b.keyCode:b.which);if(c===32){b.preventDefault();h(a);}});if(!a.can_move)a.view_form.find("#vert-btns-box").hide();a.view_form.find("#up-btn").attr('tabindex',-1).click(function(){a.task.move_record_up(a.dest);});a.view_form.find("#down-btn").attr('tabindex',-1).click(function(){a.task.move_record_down(a.dest);});a.view_form.find("#left-btn").attr('tabindex',-1).click(function(){h(a);});a.view_form.find("#right-btn").attr('tabindex',-1).click(function(){i(a);});a.view_form.find("#cancel-btn").attr("tabindex",101).text(a.task.language.cancel).on('click.task',function(b){l(a);});a.view_form.find("#ok-btn").attr("tabindex",100).text(a.task.language.ok).on('click.task',function(){j(a);});if(a.read_only)a.view_form.find("button.arrow_btn").hide();a.left_grid.$table.on('click','td',function(){var b=c(this),d=b.data('field_name'),e=a.dest.field_by_name(d);if(e.field_type==="boolean"){if(!a.dest.is_changing())a.dest.edit();e.value=!e.value;a.dest.post();}});}function e(a){f(a);a.right_grid.focus();}function f(a){var b,c,d,e,f,g;a.source.disable_controls();try{a.source.open({open_empty:true});for(b=0;b<a.source_def.length;b++)if(a.source_def[b][2])a.source.field_by_name(a.source_def[b][0]).field_caption=a.source_def[b][1];for(b=0;b<a.source_list.length;b++){e=a.source_list[b];g=false;for(c=0;c<a.dest_list.length;c++){f=a.dest_list[c];if(e[0]===f[0]){g=true;break;}}if(!g){a.source.append();for(d=0;d<a.source_def.length;d++)a.source.field_by_name(a.source_def[d][0]).value=e[d];a.source.post();}}a.source.first();}finally{a.source.enable_controls();}a.source.update_controls();a.dest.disable_controls();try{a.dest.open({open_empty:true});for(b=0;b<a.dest_def.length;b++)if(a.dest_def[b][2])a.dest.field_by_name(a.dest_def[b][0]).field_caption=a.dest_def[b][1];for(b=0;b<a.dest_list.length;b++){f=a.dest_list[b];g=false;for(c=0;c<a.source_list.length;c++){e=a.source_list[c];if(e[0]===f[0]){g=true;break;}}if(g){a.dest.append();a.dest.id.value=e[0];a.dest.name.value=e[1];for(d=2;d<a.dest_def.length;d++)a.dest.field_by_name(a.dest_def[d][0]).value=f[d-1];a.dest.post();}}a.dest.first();}finally{a.dest.enable_controls();}a.dest.update_controls();}function g(a,b){if(a.record_count()){b.append();b.id.value=a.id.value;b.name.value=a.name.value;b.post();a["delete"]();}}function h(a){g(a.source,a.dest);}function i(a){g(a.dest,a.source);}function j(a){var b=[];a.dest.each(function(c){var d,e=[];e.push(c.id.value);for(d=2;d<a.dest_def.length;d++)e.push(a.dest.field_by_name(a.dest_def[d][0]).value);b.push(e);});a.close_view_form();a.save_func(a.item,b);}function k(a){if(a.item.is_changing())if(a.cancel_func)a.cancel_func(a.item);}function l(a){a.close_view_form();}function m(a,b){if(b.keyCode===13){b.preventDefault();j(a);}}this.fields_editor=a;this.on_before_show_view_form=d;this.on_after_show_view_form=e;this.prepare_grids=f;this.move_hor=g;this.move_left=h;this.move_right=i;this.save_result=j;this.on_view_form_close_query=k;this.item_cancel=l;this.on_view_keydown=m;}a.task_events.events15=new k();function l(){function a(a){if(task.init_project&&a.f_language.value){a.task.server_function('server_set_project_langage',[a.f_language.value]);location.reload();}}this.on_after_apply=a;}a.task_events.events11=new l();function m(){function d(a){var b=a.sys_search.copy();b.open({open_empty:true});b.set_edit_fields(['find_text','case_sensitive','whole_words']);b.append_record();}function e(a){a.edit_form.title=task.language.find;a.edit_form.find("#cancel-btn").text(task.language.close).attr("tabindex",101);a.edit_form.find("#ok-btn").text(task.language.find).attr("tabindex",100).off('click.task').on('click',function(){f(a);});}function f(d){var e,f,g,h,i=c(a).width()-50,j=c(a).height()-200,k=c('<div>');if(d.find_text.value){e=d.task.server_function('server_find_in_task',[d.task.sys_tasks.task_id.value,d.find_text.value,d.case_sensitive.value,d.whole_words.value]);if(e){k.append(c('<h4>Client</h4>'));h=e.client.split('\n');for(f=0;f<h.length;f++){g=c('<p style="margin: 0px;">').text(h[f]);g.css("font-family","'Courier New', Courier, monospace");k.append(g);}k.append(c('<h4>Server</h4>'));h=e.server.split('\n');for(f=0;f<h.length;f++){g=c('<p style="margin: 0px;">').text(h[f]);g.css("font-family","'Courier New', Courier, monospace");k.append(g);}task.information(k,{title:'Search result',margin:10,width:i,height:j,text_center:false,buttons:{"Close":b},center_buttons:false,print:true});}}}function g(a,b){if(b.keyCode===13){b.preventDefault();a.edit_form.find("#ok-btn").focus();f(a);}}this.find_in_task=d;this.on_before_show_edit_form=e;this.find=f;this.on_edit_keydown=g;}a.task_events.events16=new m();function n(){function a(a){a.view_form.find('#up-btn').click(function(){a.task.move_record_up(a);});a.view_form.find('#down-btn').click(function(){a.task.move_record_down(a);});}function b(a){}function c(a){a.task_id.value=a.task.sys_items.task_id.value;a.owner_id.value=0;a.f_visible.value=true;a.f_index.value=a.record_count();a.f_type.value=1;}function d(a){a.owner_rec_id.value=a.task.sys_items.id.value;a.owner.value=a.task.sys_items.ID;}function e(a,b){var c,d=a.owner;if(a.field_name==='f_field'){c=d.task.sys_fields.copy();c.set_where({id:a.value});c.open();d.f_name.value=c.f_name.value;d.f_filter_name.value=c.f_field_name.value;}}function f(a,b){var c,d=a.owner;if(a.field_name==='f_field'){c=d.copy();b.filters.owner_rec_id.value=[d.task.sys_items.id.value,d.task.sys_items.parent.value];b.filters.master_field_is_null.value=true;b.set_view_fields(['f_field_name','f_name']);b.set_order_by(['f_field_name']);}}function g(a){var b=0;a.each(function(a){a.edit();a.f_index.value=b;a.post();b++;});a.apply();}this.on_before_show_view_form=a;this.on_after_show_view_form=b;this.on_after_append=c;this.on_before_post=d;this.on_field_changed=e;this.on_field_lookup_item_show=f;this.on_view_form_close_query=g;}a.task_events.events5=new n();function o(){function a(a){if(a.filters.foreign_index.value){a.view_form.title='Foreign keys';a.f_index_name.field_caption='Foreign key';a.set_view_fields(['f_foreign_field','f_index_name']);a.set_edit_fields(['f_foreign_field','f_index_name']);a.f_foreign_field.required=true;a.f_index_name.required=true;}else{a.view_form.title='Indices';a.f_index_name.field_caption='Index';a.set_view_fields(['f_index_name','descending']);a.set_edit_fields(['f_index_name','descending']);a.f_foreign_field.required=false;a.view_form.find("#new-btn").off('click.task');a.view_form.find("#edit-btn").off('click.task');a.view_form.find("#new-btn").on('click.task',function(){d(a,true);});a.view_form.find("#edit-btn").on('click.task',function(){d(a,false);});a.view_table.on_dblclick=function(){d(a,false);};}}function c(a,b){if(b.keyCode===45&&b.ctrlKey===true){b.preventDefault();if(a.filters.foreign_index.value)a.insert_record();else d(a,true);}else if(b.keyCode===46&&b.ctrlKey===true){b.preventDefault();a.delete_record();}}function d(a,c){var d,e=[],f=[],g=[],h='';function i(a,b){var d;if(c){if(!a.f_index_name.value)d=a.task.language.index_name_required;if(!b.length)d=a.task.language.index_fields_required;if(d){a.warning(d);throw d;}a.f_fields.value=a.server_function('server_dump_index_fields',[b]);a.post();try{a.apply();}catch(e){a.warning(e);throw e;}}else{a.read_only=false;a.cancel();}}function j(a){a.read_only=false;a.cancel();}if(c){a.append();a.read_only=false;}else if(a.record_count()>0){a.edit();a.read_only=true;g=a.server_function('server_load_index_fields',[a.f_fields.value]);}else return;e=[['id','',false],['name',a.task.language.caption_name,true]];f=[['id','',false],['name',a.task.language.caption_name,true]];d=a.task.sys_fields_editor.fields_editor(a,h,e,a.task.sys_items.get_fields_list(a.task),f,g,i,j,b,!c);a.create_inputs(d.view_form.find('div#fields-container'));}function e(a){var b=a.task.task_name,c=a.task.sys_items.f_item_name.value;if(!a.filters.foreign_index.value)a.f_index_name.value=b.toUpperCase()+'_'+c.toUpperCase()+'_'+'IDX';a.task_id.value=a.task.sys_items.task_id.value;a.owner_rec_id.value=a.task.sys_items.id.value;a.f_foreign_index.value=a.filters.foreign_index.value;}function f(a){var b,c,d;if(a.f_object.value){d=a.task.sys_items.field_by_id(a.f_object.value,'f_soft_delete');if(!d){b=field.owner.clone();c=true;b.each(function(b){if(b.f_foreign_field.value==a.id.value){c=false;return false;}});return c;}}}function g(a,b){b.on_filter_record=f;b.filtered=true;}function h(a,b){var c=a.owner;if(a.field_name==='f_foreign_field')c.f_index_name.value='FK_'+c.task.sys_items.f_table_name.value.toUpperCase()+'_'+a.display_text.toUpperCase();}function i(a){var b=a.owner,c='',d;if(a.field_name==='f_index_name'){d=b.clone();d.each(function(d){if(b.rec_no!==d.rec_no&&a.value===d.f_index_name.value){c='There is index with this name';return false;}});if(c)return c;}}this.on_before_show_view_form=a;this.on_view_keydown=c;this.edit_index=d;this.on_after_append=e;this.filter_record=f;this.on_field_lookup_item_show=g;this.on_field_changed=h;this.on_field_validate=i;}a.task_events.events10=new o();function p(){function a(a){a.task.sys_filters.on_before_show_view_form(a);}function b(a){a.task.sys_filters.on_view_form_close_query(a);}function c(a){a.task.sys_filters.on_before_post(a);}function d(a){a.task_id.value=a.task_id.value;a.f_data_type.read_only=false;a.f_visible.value=true;}function e(a,b){var c=a.owner;c.task.sys_items.sys_fields.on_field_changed(a,b);if(a.field_name==='f_object_field'){if(!c.f_name.value)c.f_name.value=b.f_name.value;if(!c.f_param_name.value)c.f_param_name.value=b.f_field_name.value;}}function f(a,b){a.owner.task.sys_items.sys_fields.on_field_lookup_item_show(a,b);}function g(a){a.owner.task.sys_items.sys_fields.on_field_validate(a);}this.on_before_show_view_form=a;this.on_view_form_close_query=b;this.on_before_post=c;this.on_after_append=d;this.on_field_changed=e;this.on_field_lookup_item_show=f;this.on_field_validate=g;}a.task_events.events12=new p();function q(){function a(a){function b(){var b=false,c;if(a.owner.id.value&&a.id.value){c=a.task.sys_indices;c.set_where({owner_rec_id:a.owner.id.value});c.open();c.each(function(c){if(c.f_foreign_index.value&&c.f_foreign_field.value===a.id.value)b=true;});}return b;}a.f_data_type.read_only=false;a.f_size.read_only=false;a.f_object.read_only=false;a.f_object_field.read_only=false;a.f_master_field.read_only=false;if(!a.is_new()&&!a.task.sys_tasks.f_manual_update.value){a.f_data_type.read_only=true;a.f_size.read_only=true;a.f_object.read_only=true;if(a.f_data_type.value!==a.task.consts.INTEGER||!a.f_object.value){a.f_object_field.read_only=true;a.f_master_field.read_only=true;}}if(b())a.f_object.read_only=true;}function c(a,b){var c=a.owner,d,e;if(b.item_name==='sys_items')b.set_view_fields(['id','f_item_name','f_name']);else if(b.item_name==='sys_fields')b.set_view_fields(['f_field_name','f_name']);if(a===c.f_object){if(c.owner===c.task.sys_items){b.filters.not_id.value=c.owner.id.value;if(c.owner.type_id.value===c.task.item_types.TASK_TYPE)b.filters.task_id.value=c.owner.id.value;else b.filters.task_id.value=c.owner.task_id.value;}b.set_order_by(['f_item_name']);b.filters.type_id.value=[c.task.item_types.CATALOG_TYPE,c.task.item_types.JOURNAL_TYPE,c.task.item_types.TABLE_TYPE];b.filters.table_id.value=0;}else if(a.field_name==='f_master_field'&&c.f_object.value){d=c.owner.id.value;e=c.task.sys_items.field_by_id(d,'parent');b.filters.owner_rec_id.value=[d,e];b.filters.not_id.value=c.id.value;b.filters.object.value=c.f_object.value;b.filters.master_field_is_null.value=true;}if(a.field_name==='f_object_field')if(c.f_object.value){d=c.f_object.value;e=c.task.sys_items.field_by_id(d,'parent');b.filters.owner_rec_id.value=[d,e];b.set_order_by(['f_field_name']);}else b.filters.owner_rec_id.value=[-1];}function d(a,c){var d='',e,f;if(!a.owner.valid_identifier(c))d=a.task.language.invalid_field_name;e=a.clone();e.each(function(b){if(a.rec_no!==b.rec_no&&c===b.f_field_name.value){d='There is a field with this name';return false;}});f=new a.task.constructors.item();if(f[c]!==b)d=a.task.language.reserved_word;return d;}function e(a){var b=a.owner,c='';if(a.field_name==='f_field_name'){c=d(b,a.value);if(c)return c;}if(a.field_name==='f_data_type'&&b.f_data_type.value===0)return b.task.language.type_is_required;}function f(a){var b=a.owner,c;if(a.field_name==='f_name'){if(b.f_field_name){if(!b.f_field_name.value)try{c=a.text.replace(' ','_').toLowerCase();if(b.owner.valid_identifier(c))b.f_field_name.value=c;}catch(d){}}else if(b.f_param_name)if(!b.f_param_name.value)try{c=a.text.replace(' ','_').lower();if(b.owner.valid_identifier(c))b.f_param_name.value=c;}catch(d){}}else if(a===b.f_object){b.f_object_field.value=null;if(b.f_object.value){b.f_data_type.value=b.task.consts.INTEGER;b.f_data_type.read_only=true;}else if(b.is_new()||b.task.sys_tasks.f_manual_update.value){b.f_data_type.value=null;b.f_data_type.read_only=false;}}else if(a===b.f_data_type)if(b.f_data_type.value===b.task.consts.TEXT)b.f_size.value=10;else b.f_size.value=null;if(a===b.f_data_type||a===b.f_object)b.f_alignment.value=g(b,b.f_data_type.value,b.f_object.value);}function g(a,b,c){var d;if(b===a.task.consts.INTEGER||b===a.task.consts.FLOAT||b===a.task.consts.CURRENCY)d=a.task.consts.ALIGN_RIGHT;else if(b===a.task.consts.DATE||b===a.task.consts.DATETIME)d=a.task.consts.ALIGN_CENTER;else d=a.task.consts.ALIGN_LEFT;if(c)d=a.task.consts.ALIGN_LEFT;return d;}function h(a){var b;if(a.id.value){b=a.task.sys_fields.server_function('server_can_delete_field',[a.id.value]);if(b){a.warning(b);return false;}}}function i(a){a.f_data_type.read_only=false;}function j(a){if(a.f_object.value&&!a.f_object_field.value){a.warning(a.task.language.object_field_required);return false;}if(a.f_data_type.value!==a.task.consts.TEXT)a.f_size.value=null;a.task_id.value=a.task.item_tree.task_id.value;}function k(a){}function l(a){}this.on_before_show_edit_form=a;this.on_field_lookup_item_show=c;this.check_valid_field_name=d;this.on_field_validate=e;this.on_field_changed=f;this.get_alignment=g;this.on_before_delete=h;this.on_after_append=i;this.on_before_post=j;this.on_before_edit=k;this.on_after_scroll=l;}a.task_events.events6=new q();function r(){function a(a,b){var c=a.owner;c.post();c.owner.post();if(c.id.value)c.record_status=c.task.consts.RECORD_MODIFIED;else c.record_status=c.task.consts.RECORD_INSERTED;c.owner.apply();c.owner.edit();}this.on_field_changed=a;}a.task_events.events8=new r();})(window);